<%- include('layout', { title: 'Dashboard' }) %>

  <div class="shell">
    <% if ((user.role==='profesor' || user.role==='alumno') && !user.validated) { %>
      <!-- Usuario no validado -->
      <div class="card pending-validation-card">
        <div class="pending-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#f39c12" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        </div>

        <h2 class="pending-title">Cuenta Pendiente de Validación</h2>

        <p class="pending-message">
          <% if (user.role === 'alumno') { %>
            Tu cuenta de alumno ha sido creada exitosamente, pero aún no ha sido validada por un administrador. 
            Un administrador debe validar tu cuenta y asignarte un curso para que puedas acceder a todas las funcionalidades.
          <% } else { %>
            Tu cuenta de profesor ha sido creada exitosamente, pero aún no ha sido validada por un administrador.
          <% } %>
        </p>

        <div class="pending-info">
          <h3>¿Qué significa esto?</h3>
          <ul>
            <li>Tu cuenta está en proceso de revisión</li>
            <li>No podrás acceder a las funcionalidades de profesor hasta ser validado</li>
            <li>Un administrador revisará y validará tu cuenta pronto</li>
          </ul>
        </div>
      </div>
      <% } else { %>
        <!-- Dashboard normal -->
        <div class="dashboard-grid">
          <% if (user.role==='admin' ) { %>
            <!-- Dashboard Admin -->
            <div class="dashboard-card">
              <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
              </div>
              <div class="card-content">
                <h3>Total Usuarios</h3>
                <p class="stat-number">
                  <%= stats.totalUsers %>
                </p>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="8.5" cy="7" r="4"></circle>
                  <polyline points="17 11 19 13 23 9"></polyline>
                </svg>
              </div>
              <div class="card-content">
                <h3>Profesores Pendientes</h3>
                <p class="stat-number <%= stats.pendingProfessors > 0 ? 'alert' : '' %>">
                  <%= stats.pendingProfessors %>
                </p>
                <% if (stats.pendingProfessors> 0) { %>
                  <a href="/admin" class="card-link">Ver panel →</a>
                  <% } %>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
              <div class="card-content">
                <h3>Total Estudiantes</h3>
                <p class="stat-number">
                  <%= stats.totalStudents %>
                </p>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
              </div>
              <div class="card-content">
                <h3>Calificaciones Registradas</h3>
                <p class="stat-number">
                  <%= stats.totalGrades %>
                </p>
              </div>
            </div>

            <% } else if (user.role==='profesor' ) { %>
              <!-- Dashboard Profesor -->
              <div class="dashboard-card">
                <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                </div>
                <div class="card-content">
                  <h3>Calificaciones Registradas</h3>
                  <p class="stat-number">
                    <%= stats.totalGrades %>
                  </p>
                </div>
              </div>

              <div class="dashboard-card">
                <div class="card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                </div>
                <div class="card-content">
                  <h3>Asistencias Hoy</h3>
                  <p class="stat-number">
                    <%= stats.todayAttendance %>
                  </p>
                </div>
              </div>

              <div class="dashboard-card full-width">
                <h3>Últimas Calificaciones Registradas</h3>
                <% if (stats.recentGrades && stats.recentGrades.length> 0) { %>
                  <div class="recent-list">
                    <% stats.recentGrades.forEach(grade=> { %>
                      <div class="recent-item">
                        <div class="recent-info">
                          <strong>
                            <%= grade.estudiante_nombre || 'Estudiante' %>
                          </strong>
                          <span class="recent-meta">Nota: <%= grade.nota %> - <%= new
                                Date(grade.fecha).toLocaleDateString() %></span>
                        </div>
                        <span class="grade-badge">
                          <%= grade.nota %>
                        </span>
                      </div>
                      <% }) %>
                  </div>
                  <% } else { %>
                    <p class="empty-state">No hay calificaciones registradas aún</p>
                    <% } %>
              </div>

              <% } else if (user.role==='alumno' ) { %>
                <!-- Dashboard Alumno -->
                <div class="dashboard-card">
                  <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                      <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                  </div>
                  <div class="card-content">
                    <h3>Promedio General</h3>
                    <p class="stat-number">
                      <%= stats.averageGrade %>
                    </p>
                  </div>
                </div>

                <div class="dashboard-card">
                  <div class="card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                      <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                  </div>
                  <div class="card-content">
                    <h3>Asistencias del Mes</h3>
                    <p class="stat-number">
                      <%= stats.monthAttendance %>
                    </p>
                  </div>
                </div>

                <div class="dashboard-card full-width">
                  <h3>Últimas Calificaciones Recibidas</h3>
                  <% if (stats.recentGrades && stats.recentGrades.length> 0) { %>
                    <div class="recent-list">
                      <% stats.recentGrades.forEach(grade=> { %>
                        <div class="recent-item">
                          <div class="recent-info">
                            <strong>Profesor: <%= grade.profesor_nombre || 'N/A' %></strong>
                            <span class="recent-meta">
                              <%= new Date(grade.fecha).toLocaleDateString() %>
                            </span>
                          </div>
                          <span class="grade-badge">
                            <%= grade.nota %>
                          </span>
                        </div>
                        <% }) %>
                    </div>
                    <% } else { %>
                      <p class="empty-state">No tienes calificaciones registradas aún</p>
                      <% } %>
                </div>
                <% } %>
        </div>
        <% } %>
  </div>

  <style>
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .dashboard-card {
      background: var(--card-bg);
      backdrop-filter: blur(8px);
      border-radius: var(--radius);
      border: var(--glass-border);
      box-shadow: var(--shadow);
      padding: 25px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
    }

    .dashboard-card.full-width {
      grid-column: 1 / -1;
    }

    .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .card-content h3 {
      margin: 0 0 10px 0;
      color: #7f8c8d;
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      margin: 0;
    }

    .stat-number.alert {
      color: #f39c12;
    }

    .card-link {
      display: inline-block;
      margin-top: 10px;
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      transition: color 0.3s;
    }

    .card-link:hover {
      color: var(--primary-hover);
    }

    .recent-list {
      margin-top: 15px;
    }

    .recent-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 10px;
      margin-bottom: 10px;
      transition: background 0.3s;
    }

    .recent-item:hover {
      background: rgba(255, 255, 255, 0.8);
    }

    .recent-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .recent-info strong {
      color: var(--accent);
      font-size: 1rem;
    }

    .recent-meta {
      color: #7f8c8d;
      font-size: 0.85rem;
    }

    .grade-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 1.1rem;
      min-width: 50px;
      text-align: center;
    }

    .empty-state {
      text-align: center;
      color: #95a5a6;
      font-style: italic;
      padding: 30px;
    }

    /* Estilos para pending validation */
    .pending-validation-card {
      max-width: 600px;
      margin: 40px auto;
      text-align: center;
      padding: 50px 40px;
    }

    .pending-icon {
      margin-bottom: 30px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.6;
      }
    }

    .pending-title {
      color: #f39c12;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }

    .pending-message {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .pending-info {
      background: rgba(243, 156, 18, 0.1);
      border-left: 4px solid #f39c12;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: left;
    }

    .pending-info h3 {
      color: #f39c12;
      margin-top: 0;
      margin-bottom: 15px;
    }

    .pending-info ul {
      margin: 0;
      padding-left: 20px;
    }

    .pending-info li {
      margin-bottom: 10px;
      color: #555;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <%- include('footer') %>