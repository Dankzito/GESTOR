<%- include('layout', { title: 'Calificaciones' }) %>
  <div class="card">
    <h2>Gestor de Calificaciones</h2>
    <p style="color: #7f8c8d; margin-bottom: 20px;">
      Las calificaciones se crean desde el panel de administración o por profesores validados.
    </p>

        <table class="tabla">
          <thead>
            <tr>
              <th>Estudiante</th>
              <th>Materia / Profesor</th>
              <th>Nota</th>
              <th>Comentario</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% calificaciones.forEach(c=> { %>
              <tr>
                <td>
                  <%= c.estudiante_nombre || '—' %>
                </td>
                <td>
                  <% if(c.materia) { %>
                    <%= c.materia %>
                      <% if(c.profesor_nombre) { %> (<%= c.profesor_nombre %>) <% } %>
                            <% } else { %>
                              <%= c.profesor_nombre || '—' %>
                                <% } %>
                </td>
                <td>
                  <%= c.nota %>
                </td>
                <td>
                  <%= c.comentario %>
                </td>
                <td>
                  <%= new Date(c.fecha).toLocaleString() %>
                </td>
                <td>
                  <% if (user.role==='profesor' || user.role==='admin' ) { %>
                    <form style="display:inline" method="post" action="/calificaciones/<%= c.id %>/edit">
                      <input name="nota" value="<%= c.nota %>" style="width:60px" type="number" />
                      <input name="comentario" value="<%= c.comentario %>" />
                      <button class="link-btn">Editar</button>
                    </form>
                    <% } %>
                      <% if (user.role==='admin' ) { %>
                        <form style="display:inline" method="post" action="/calificaciones/<%= c.id %>/delete"><button
                            class="link-btn">Eliminar</button></form>
                        <% } %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
  </div>
  <%- include('footer') %>